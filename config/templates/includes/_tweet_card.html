<div class="p-3 border-bottom border-secondary position-relative">
    {% if not from_comments %}
    <!-- 全体のリンク (コメントでない場合のみ) -->
    <a href="{% url 'tweets:tweet_detail' pk=tweet.id %}" class="stretched-link"></a>
    {% endif %}
    
    <div class="d-flex position-relative w-100">
        <!-- プロフィール画像部分 -->
        <div class="flex-shrink-0" style="width: 48px; margin-right: 12px; z-index: 2;">
            {% include "includes/_profile_image.html" with user=tweet.user size=48 %}
        </div>
        
        <!-- コンテンツ部分 -->
        <div class="flex-grow-1" style="min-width: 0; max-width: calc(100% - 60px);">
            <!-- ユーザー情報 -->
            {% include "includes/_user_info.html" with user=tweet.user show_timestamp=True timestamp=tweet.created_at %}
            
            <!-- ツイート本文 -->
            {% if tweet.content %}
            <div class="mb-3" style="overflow-wrap: break-word; word-break: break-word;">
                {{ tweet.content }}
            </div>
            {% endif %}
            
            <!-- ツイート画像 -->
            {% if tweet.image %}
            <div class="tweet-image-container">
                <img src="{{ tweet.image.url }}" 
                     alt="ツイート画像" 
                     class="tweet-image">
            </div>
            {% endif %}

            <!-- 投稿日時（詳細ページの場合のみ） -->
            {% if is_detail %}
            <div class="text-secondary small">
                <div class="d-flex py-2 mb-2 border-bottom border-secondary">
                  {{ tweet.created_at|date:"G:i" }} · {{ tweet.created_at|date:"Y年n月j日" }}
                  {% if tweet.retweet_count > 0 %}
                          · <span class="ms-1">{{ tweet.retweet_count }}件の表示</span>
                  {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- インタラクションボタン -->
            <div class="d-flex justify-content-between align-items-center w-100 position-relative">
                <div class="d-flex align-items-center">
                    {% if not from_comments %}
                    <a href="{% url 'tweets:tweet_detail' pk=tweet.id %}" class="btn btn-ghost p-1 d-flex align-items-center text-decoration-none position-relative">
                        <i class="bi bi-chat"></i>
                    </a>
                    {% else %}
                    <button class="btn btn-ghost p-1 position-relative">
                        <i class="bi bi-chat"></i>
                    </button>
                    {% endif %}
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn btn-ghost p-1 position-relative">
                        <i class="bi bi-repeat"></i>
                    </button>
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn btn-ghost p-1 position-relative">
                        <i class="bi bi-heart"></i>
                    </button>
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn btn-ghost p-1 position-relative">
                        <i class="bi bi-bookmark"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .tweet-image-container {
        max-width: 100%;
        margin-bottom: 1rem;
        position: relative;
    }
    
    .tweet-image {
        width: 100%;
        height: auto;
        object-fit: contain;
        border-radius: 0.375rem;
    }
    
    /* モバイルサイズ */
    .tweet-image {
        max-height: 80vh;
    }
    
    /* タブレットサイズ */
    @media (min-width: 768px) {
        .tweet-image-container {
            max-width: 500px;
        }
        .tweet-image {
            max-height: 60vh;
        }
    }
    
    /* デスクトップサイズ */
    @media (min-width: 1024px) {
        .tweet-image-container {
            max-width: 450px;
        }
        .tweet-image {
            max-height: 50vh;
        }
    }

    /* 詳細画面用の調整 */
    .tweet-detail .tweet-image-container {
        max-width: min(100%, 600px);
    }
    
    @media (min-width: 1024px) {
        .tweet-detail .tweet-image {
            max-height: 45vh;
        }
    }

    /* 全体リンク用のスタイル */
    .stretched-link::after {
        pointer-events: auto;
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1;
        background-color: rgba(0,0,0,0);
    }

    .position-relative {
        position: relative;
    }

    .btn-ghost, a {
        z-index: 2;
    }
</style>
